<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Laptop Tracker</title>

  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }

    th {
      background: #eee;
      cursor: pointer;
    }

    th:hover {
      background: #ddd;
    }

    .flagged {
      background-color: #ffdada;
    }

    .add-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 55px;
      height: 55px;
      font-size: 28px;
      border-radius: 50%;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .admin-btn {
      position: fixed;
      bottom: 20px;
      right: 90px;
      padding: 10px 15px;
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }

    .remove-btn {
      background: red;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
    }

    input {
      width: 100%;
    }
  </style>
</head>
<body>

<h1>Code Ninjas Studio City Laptop Tracker</h1>

<table>
  <thead>
    <tr>
      <th onclick="setSort('name')">Name</th>
      <th onclick="setSort('flagged')">Flag</th>
      <th onclick="setSort('notes')">Notes</th>
      <th onclick="setSort('lastReset')">Last Reset</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody id="laptopTable"></tbody>
</table>

<button class="admin-btn" onclick="enableAdmin()">Admin Mode</button>
<button class="add-btn" onclick="addLaptop()">+</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, deleteDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyASFh8I0-GvyM-FJlr8zya7fO-ErG0x42I",
    authDomain: "cnsc-laptop-tracker.firebaseapp.com",
    projectId: "cnsc-laptop-tracker",
    storageBucket: "cnsc-laptop-tracker.firebasestorage.app",
    messagingSenderId: "1304726115",
    appId: "1:1304726115:web:95a48c1479d48b93b88656"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  await signInAnonymously(auth);

  const table = document.getElementById("laptopTable");

  const adminPassword = "admin123"; // change if desired
  let adminUnlocked = false;

  let laptopData = [];
  let currentSort = "name";
  let sortAsc = true;

  window.enableAdmin = () => {
    const pass = prompt("Enter admin password:");
    if (pass === adminPassword) {
      adminUnlocked = true;
      alert("Admin mode enabled.");
    } else {
      alert("Wrong password.");
    }
  };

  window.setSort = (field) => {
    if (currentSort === field) {
      sortAsc = !sortAsc;
    } else {
      currentSort = field;
      sortAsc = true;
    }
    renderTable();
  };

  function renderTable() {
    table.innerHTML = "";

    const sorted = [...laptopData].sort((a, b) => {
      let valA = a[currentSort] || "";
      let valB = b[currentSort] || "";

      if (typeof valA === "boolean") {
        return sortAsc ? valA - valB : valB - valA;
      }

      return sortAsc
        ? String(valA).localeCompare(String(valB))
        : String(valB).localeCompare(String(valA));
    });

    sorted.forEach(data => {
      const row = document.createElement("tr");
      if (data.flagged) row.classList.add("flagged");

      row.innerHTML = `
        <td>${data.name}</td>
        <td>
          <input type="checkbox" ${data.flagged ? "checked" : ""}
            onchange="toggleFlag('${data.name}', this.checked)">
        </td>
        <td>
          <input value="${data.notes || ""}"
            onchange="updateNotes('${data.name}', this.value)">
        </td>
        <td>
          <input type="date"
            value="${data.lastReset || ""}"
            onchange="updateDate('${data.name}', this.value)">
        </td>
        <td>
          <button class="remove-btn"
            onclick="removeLaptop('${data.name}')">X</button>
        </td>
      `;

      table.appendChild(row);
    });
  }

  onSnapshot(collection(db, "laptops"), snapshot => {
    laptopData = [];
    snapshot.forEach(docSnap => {
      laptopData.push(docSnap.data());
    });
    renderTable();
  });

  window.toggleFlag = async (id, value) => {
    await updateDoc(doc(db, "laptops", id), { flagged: value });
  };

  window.updateNotes = async (id, value) => {
    await updateDoc(doc(db, "laptops", id), { notes: value });
  };

  window.updateDate = async (id, value) => {
    await updateDoc(doc(db, "laptops", id), { lastReset: value });
  };

  window.addLaptop = async () => {
    if (!adminUnlocked) {
      alert("Enable Admin Mode first.");
      return;
    }

    const name = prompt("Laptop name (ex: HP-02):");
    if (!name) return;

    const existing = await getDoc(doc(db, "laptops", name));
    if (existing.exists()) {
      alert("Laptop already exists.");
      return;
    }

    await setDoc(doc(db, "laptops", name), {
      name: name,
      flagged: false,
      notes: "",
      lastReset: ""
    });
  };

  window.removeLaptop = async (id) => {
    if (!adminUnlocked) {
      alert("Enable Admin Mode first.");
      return;
    }

    await deleteDoc(doc(db, "laptops", id));
  };
</script>

</body>
</html>
